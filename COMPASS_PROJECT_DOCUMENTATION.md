# Compass ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå®Œå…¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## ç›®æ¬¡
1. [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦](#ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦)
2. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
3. [æ¨©é™ã‚·ã‚¹ãƒ†ãƒ ](#æ¨©é™ã‚·ã‚¹ãƒ†ãƒ )
4. [ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«](#ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«)
5. [APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ](#apiã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ)
6. [ä¸»è¦æ©Ÿèƒ½](#ä¸»è¦æ©Ÿèƒ½)
7. [ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ ](#ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ )
8. [é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼](#é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼)

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

**Compass**ã¯ã€å»ºè¨­ãƒ»è¨­è¨ˆæ¥­ç•Œå‘ã‘ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

### ä¸»ãªæ©Ÿèƒ½
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ï¼ˆè¤‡æ•°ç‰©ä»¶ã®é€²æ—ç®¡ç†ï¼‰
- ã‚¿ã‚¹ã‚¯ç®¡ç†ï¼ˆã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆã€ã‚«ãƒ³ãƒãƒ³ãƒœãƒ¼ãƒ‰ï¼‰
- äººå“¡ç®¡ç†ï¼ˆç¤¾å†…ãƒ¡ãƒ³ãƒãƒ¼ã€å”åŠ›ä¼šç¤¾ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰
- æ¨©é™ç®¡ç†ï¼ˆãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ï¼‰
- ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†
- ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãƒ­ã‚°

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: Firebase Functions (Node.js + TypeScript)
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: React + TypeScript + Vite
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: Cloud Firestore
- **èªè¨¼**: Firebase Authentication
- **ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°**: Firebase Hosting

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ï¼‰                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ HTTPS
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Firebase Hosting (React SPA)                 â”‚
â”‚  ãƒ»App.tsx (ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)                              â”‚
â”‚  ãƒ»Components (UI)                                   â”‚
â”‚  ãƒ»API Client (lib/api.ts)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ REST API
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Firebase Functions (API Server)                â”‚
â”‚  ãƒ»Express.js ãƒ«ãƒ¼ã‚¿ãƒ¼                                â”‚
â”‚  ãƒ»èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢                                      â”‚
â”‚  ãƒ»ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Cloud Firestore (DB)                    â”‚
â”‚  Collections:                                        â”‚
â”‚  ãƒ»orgs/{orgId}/projects                            â”‚
â”‚  ãƒ»orgs/{orgId}/tasks                               â”‚
â”‚  ãƒ»orgs/{orgId}/projectMembers                      â”‚
â”‚  ãƒ»orgs/{orgId}/clients                             â”‚
â”‚  ãƒ»orgs/{orgId}/collaborators                       â”‚
â”‚  ãƒ»users                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ã‚°ã‚¤ãƒ³**
   ```
   User â†’ Firebase Auth â†’ IDãƒˆãƒ¼ã‚¯ãƒ³å–å¾— â†’ localStorageä¿å­˜
   ```

2. **APIå‘¼ã³å‡ºã—**
   ```
   Component â†’ api.ts â†’ IDãƒˆãƒ¼ã‚¯ãƒ³ä»˜ä¸ â†’ Functions API
                                         â†“
                                    èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
                                         â†“
                                    ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
                                         â†“
                                    Firestoreæ“ä½œ
                                         â†“
                                    ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¿”å´
   ```

3. **æ¨©é™ãƒã‚§ãƒƒã‚¯**
   ```
   ãƒªã‚¯ã‚¨ã‚¹ãƒˆ â†’ èªè¨¼ â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾— â†’ ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ­ãƒ¼ãƒ«ç¢ºèª
                                    â†“
                              ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ­ãƒ¼ãƒ«ç¢ºèª
                                    â†“
                              æ¨©é™ã«å¿œã˜ãŸå‡¦ç†
   ```

---

## æ¨©é™ã‚·ã‚¹ãƒ†ãƒ 

### ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ­ãƒ¼ãƒ«ï¼ˆRoleï¼‰

ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã«é©ç”¨ã•ã‚Œã‚‹æ¨©é™ãƒ¬ãƒ™ãƒ«:

| ãƒ­ãƒ¼ãƒ« | èª¬æ˜ | ä¸»ãªæ¨©é™ |
|--------|------|---------|
| `super_admin` | ã‚¹ãƒ¼ãƒ‘ãƒ¼ç®¡ç†è€… | ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®å®Œå…¨ãªæ¨©é™ |
| `admin` | çµ„ç¹”ç®¡ç†è€… | çµ„ç¹”å…¨ä½“ã®ç®¡ç†ã€ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç† |
| `project_manager` | PMãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ã€ãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ  |
| `sales` | å–¶æ¥­ | å–¶æ¥­é–¢é€£ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç† |
| `designer` | è¨­è¨ˆ | è¨­è¨ˆé–¢é€£ã®ã‚¿ã‚¹ã‚¯ç®¡ç† |
| `site_manager` | æ–½å·¥ç®¡ç† | æ–½å·¥é–¢é€£ã®ã‚¿ã‚¹ã‚¯ç®¡ç† |
| `worker` | è·äºº | è‡ªåˆ†ã®ã‚¿ã‚¹ã‚¯ã®ã¿ |
| `viewer` | é–²è¦§è€… | é–²è¦§ã®ã¿ |

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆProjectRoleï¼‰

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå˜ä½ã§ä»˜ä¸ã•ã‚Œã‚‹æ¨©é™:

| ãƒ­ãƒ¼ãƒ« | èª¬æ˜ | ä¸»ãªæ¨©é™ |
|--------|------|---------|
| `owner` | ã‚ªãƒ¼ãƒŠãƒ¼ | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ‰€æœ‰è€…ã€ã™ã¹ã¦ã®æ“ä½œå¯èƒ½ |
| `manager` | ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ã€ãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ  |
| `member` | ãƒ¡ãƒ³ãƒãƒ¼ | ã‚¿ã‚¹ã‚¯ä½œæˆãƒ»ç·¨é›† |
| `viewer` | é–²è¦§è€… | é–²è¦§ã®ã¿ |

### æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹

#### ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ­ãƒ¼ãƒ«æ¨©é™

```typescript
// functions/src/lib/roles.ts ã‚ˆã‚Š

export const ROLE_PERMISSIONS: Record<Role, RolePermissions> = {
  super_admin: {
    canViewAllProjects: true,
    canEditAllProjects: true,
    canCreateProjects: true,
    canDeleteProjects: true,
    canManageMembers: true,
    canViewAllTasks: true,
    canEditAllTasks: true,
    canCreateTasks: true,
    canDeleteTasks: true,
    canManageUsers: true,
  },
  admin: {
    canViewAllProjects: true,
    canEditAllProjects: true,
    canCreateProjects: true,
    canDeleteProjects: true,
    canManageMembers: true,
    canViewAllTasks: true,
    canEditAllTasks: true,
    canCreateTasks: true,
    canDeleteTasks: true,
    canManageUsers: true,
  },
  project_manager: {
    canViewAllProjects: false,      // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ã®ã¿
    canEditAllProjects: false,
    canCreateProjects: true,
    canDeleteProjects: false,
    canManageMembers: true,         // å‚åŠ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã¿
    canViewAllTasks: false,
    canEditAllTasks: false,
    canCreateTasks: true,
    canDeleteTasks: true,
    canManageUsers: false,
  },
  // ... ä»–ã®ãƒ­ãƒ¼ãƒ«
};
```

#### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ­ãƒ¼ãƒ«æ¨©é™

```typescript
export const PROJECT_ROLE_PERMISSIONS: Record<ProjectRole, ProjectPermissions> = {
  owner: {
    canEditProject: true,
    canDeleteProject: true,
    canManageMembers: true,
    canViewTasks: true,
    canEditTasks: true,
    canCreateTasks: true,
    canDeleteTasks: true,
    canViewFiles: true,
    canUploadFiles: true,
  },
  manager: {
    canEditProject: true,
    canDeleteProject: false,
    canManageMembers: true,
    canViewTasks: true,
    canEditTasks: true,
    canCreateTasks: true,
    canDeleteTasks: true,
    canViewFiles: true,
    canUploadFiles: true,
  },
  // ... ä»–ã®ãƒ­ãƒ¼ãƒ«
};
```

### æ¨©é™ãƒã‚§ãƒƒã‚¯ã®å„ªå…ˆé †ä½

**é‡è¦**: çµ„ç¹”ãƒ¬ãƒ™ãƒ«ã®æ¨©é™ãŒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«ã®æ¨©é™ã‚ˆã‚Šã‚‚å„ªå…ˆã•ã‚Œã¾ã™ã€‚

```typescript
// functions/src/lib/access-control.ts ã‚ˆã‚Š

export async function canManageProjectMembers(
  user: User,
  project: Project,
  orgId: string
): Promise<boolean> {
  // 1. çµ„ç¹”ãƒ¬ãƒ™ãƒ«ã®æ¨©é™ãŒæœ€å„ªå…ˆ
  if (user.role === 'super_admin') return true;
  if (user.role === 'admin') return true;
  if (user.role === 'project_manager') return true;

  // 2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚ªãƒ¼ãƒŠãƒ¼ã¯å¸¸ã«ç®¡ç†å¯èƒ½
  if (project.ownerUserId === user.id) return true;

  // 3. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ã®æ¨©é™ã‚’ç¢ºèª
  const permissions = await getProjectMemberPermissions(orgId, project.id, user.id);
  if (permissions?.canManageMembers) return true;

  return false;
}
```

### ãƒ¡ãƒ³ãƒãƒ¼åŒºåˆ†ï¼ˆMemberTypeï¼‰

| åŒºåˆ† | èª¬æ˜ | åˆ¶ç´„ |
|-----|------|-----|
| `member` | æ­£ç¤¾å“¡/æ­£è¦ãƒ¡ãƒ³ãƒãƒ¼ | ãƒ—ãƒ©ãƒ³ä¸Šé™ã«åˆ¶é™ã•ã‚Œã‚‹ |
| `guest` | å¤–éƒ¨å”åŠ›è€…/ã‚²ã‚¹ãƒˆ | ãƒ—ãƒ©ãƒ³ä¸Šé™ã«åˆ¶é™ã•ã‚Œã‚‹ã€æ¨©é™åˆ¶é™ã‚ã‚Š |

---

## ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### Firestoreã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ§‹é€ 

```
firestore/
â”œâ”€â”€ orgs/{orgId}/
â”‚   â”œâ”€â”€ projects/{projectId}         # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
â”‚   â”œâ”€â”€ tasks/{taskId}               # ã‚¿ã‚¹ã‚¯
â”‚   â”œâ”€â”€ projectMembers/{memberId}    # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼
â”‚   â”œâ”€â”€ clients/{clientId}           # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ collaborators/{collaboratorId} # å”åŠ›è€…
â”‚   â”œâ”€â”€ invitations/{invitationId}   # æ‹›å¾…
â”‚   â””â”€â”€ activityLogs/{logId}         # ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãƒ­ã‚°
â”‚
â””â”€â”€ users/{userId}                   # ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«ï¼‰
```

### ä¸»è¦ãƒ‡ãƒ¼ã‚¿å‹

#### Userï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰

```typescript
export interface User {
  id: string;                    // ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆFirebase Auth UIDï¼‰
  email: string;                 // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
  displayName: string;           // è¡¨ç¤ºå
  orgId: string;                 // æ‰€å±çµ„ç¹”ID
  role: Role;                    // ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ­ãƒ¼ãƒ«
  memberType: MemberType;        // ãƒ¡ãƒ³ãƒãƒ¼åŒºåˆ†ï¼ˆmember/guestï¼‰
  è·ç¨®?: string;                 // è·ç¨®
  éƒ¨ç½²?: string;                 // éƒ¨ç½²
  é›»è©±ç•ªå·?: string;
  photoURL?: string;
  isActive: boolean;
  guestPermissions?: GuestPermissions; // ã‚²ã‚¹ãƒˆæ¨©é™ï¼ˆguestæ™‚ã®ã¿ï¼‰
  createdAt: Timestamp;
  updatedAt: Timestamp;
  lastLoginAt?: Timestamp;
}
```

#### Projectï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼‰

```typescript
export interface Project {
  id: string;                    // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID
  ç‰©ä»¶å: string;                // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå
  ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ?: string;          // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå
  ownerUserId: string;           // ã‚ªãƒ¼ãƒŠãƒ¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
  ownerOrgId: string;            // ã‚ªãƒ¼ãƒŠãƒ¼ã®çµ„ç¹”ID
  visibility: 'private' | 'organization'; // å…¬é–‹ç¯„å›²
  äºˆå®šé–‹å§‹æ—¥?: string;
  äºˆå®šçµ‚äº†æ—¥?: string;
  status: string;
  createdAt: Timestamp;
  updatedAt: Timestamp;
  deletedAt?: Timestamp;         // ã‚½ãƒ•ãƒˆãƒ‡ãƒªãƒ¼ãƒˆ
}
```

#### ProjectMemberï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ï¼‰

```typescript
export interface ProjectMember {
  id: string;                    // ãƒ¡ãƒ³ãƒãƒ¼ID
  projectId: string;             // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID
  userId: string;                // ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
  email: string;                 // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
  displayName: string;           // è¡¨ç¤ºå
  orgId: string;                 // æ‰€å±çµ„ç¹”ID
  orgName: string;               // æ‰€å±çµ„ç¹”å
  role: ProjectRole;             // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã®ãƒ­ãƒ¼ãƒ«
  è·ç¨®?: string;
  permissions: ProjectPermissions; // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã®æ¨©é™
  invitedBy: string;
  invitedAt: Timestamp;
  joinedAt?: Timestamp;
  status: 'invited' | 'active' | 'inactive';
  createdAt: Timestamp;
  updatedAt: Timestamp;
}
```

#### Taskï¼ˆã‚¿ã‚¹ã‚¯ï¼‰

```typescript
export interface Task {
  id: string;
  projectId: string;
  ã‚¿ã‚¹ã‚¯å: string;
  äºˆå®šé–‹å§‹æ—¥?: string;
  æœŸé™?: string;
  å®Ÿç¸¾é–‹å§‹æ—¥?: string;
  å®Ÿç¸¾å®Œäº†æ—¥?: string;
  assignedTo?: string;           // æ‹…å½“è€…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
  assignedToEmail?: string;
  status: string;
  priority?: string;
  é€²æ—ç‡?: number;
  createdBy: string;
  createdAt: Timestamp;
  updatedAt: Timestamp;
  deletedAt?: Timestamp;
}
```

#### Clientï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰

```typescript
export interface Client {
  id: string;
  name: string;
  createdAt: Timestamp;
  createdBy: string;
  updatedAt: Timestamp;
}
```

#### Collaboratorï¼ˆå”åŠ›è€…ï¼‰

```typescript
export interface Collaborator {
  id: string;
  name: string;                  // å”åŠ›è€…åï¼ˆãƒ¡ãƒ¼ãƒ«ãªã—ï¼‰
  createdAt: Timestamp;
  createdBy: string;
  updatedAt: Timestamp;
}
```

---

## APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§

```typescript
// functions/src/index.ts ã‚ˆã‚Š

app.use('/api/projects', projectsRouter);              // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†
app.use('/api/tasks', tasksRouter);                    // ã‚¿ã‚¹ã‚¯ç®¡ç†
app.use('/api/people', peopleRouter);                  // äººå“¡ç®¡ç†
app.use('/api/users', usersRouter);                    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
app.use('/api/clients', clientsRouter);                // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç®¡ç†
app.use('/api/collaborators', collaboratorsRouter);    // å”åŠ›è€…ç®¡ç†
app.use('/api', projectMembersRouter);                 // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼
app.use('/api/invitations', invitationsRouter);        // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ‹›å¾…
app.use('/api/org-invitations', orgInvitationsRouter); // çµ„ç¹”æ‹›å¾…
app.use('/api/notifications', notificationsRouter);    // é€šçŸ¥
app.use('/api', activityLogsRouter);                   // ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãƒ­ã‚°
app.use('/api/schedule', scheduleRouter);              // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
app.use('/api/calendar', calendarRouter);              // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼
app.use('/api/jobs', jobsRouter);                      // ã‚¸ãƒ§ãƒ–ç®¡ç†
app.use('/api/settings', settingsRouter);              // è¨­å®š
app.use('/api/organizations', organizationsRouter);    // çµ„ç¹”ç®¡ç†
app.use('/api', excelRouter);                          // Excel ã‚¤ãƒ³ãƒãƒ¼ãƒˆ/ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
app.use('/api/admin', adminCleanupRouter);             // ç®¡ç†è€…æ©Ÿèƒ½
```

### ä¸»è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè©³ç´°

#### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†

```
GET    /api/projects                    # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§å–å¾—
POST   /api/projects                    # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
GET    /api/projects/:id                # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè©³ç´°å–å¾—
PATCH  /api/projects/:id                # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ›´æ–°
DELETE /api/projects/:id                # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‰Šé™¤
```

#### ã‚¿ã‚¹ã‚¯ç®¡ç†

```
GET    /api/tasks                       # ã‚¿ã‚¹ã‚¯ä¸€è¦§å–å¾—
POST   /api/tasks                       # ã‚¿ã‚¹ã‚¯ä½œæˆ
GET    /api/tasks/:id                   # ã‚¿ã‚¹ã‚¯è©³ç´°å–å¾—
PATCH  /api/tasks/:id                   # ã‚¿ã‚¹ã‚¯æ›´æ–°
DELETE /api/tasks/:id                   # ã‚¿ã‚¹ã‚¯å‰Šé™¤
POST   /api/tasks/:id/complete          # ã‚¿ã‚¹ã‚¯å®Œäº†
POST   /api/tasks/:id/move              # ã‚¿ã‚¹ã‚¯æ—¥ä»˜ç§»å‹•
```

#### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†

```
GET    /api/projects/:projectId/members              # ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§
POST   /api/projects/:projectId/members              # ãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ ï¼ˆæ‹›å¾…ï¼‰
GET    /api/projects/:projectId/manageable-users     # æ‹›å¾…å€™è£œãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§
PATCH  /api/projects/:projectId/members/:userId      # ãƒ¡ãƒ³ãƒãƒ¼æ›´æ–°
DELETE /api/projects/:projectId/members/:userId      # ãƒ¡ãƒ³ãƒãƒ¼å‰Šé™¤
POST   /api/projects/:projectId/members/:userId/accept # æ‹›å¾…æ‰¿èª
```

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†

```
GET    /api/users                       # ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—
GET    /api/users/me                    # ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
GET    /api/users/:id                   # ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°å–å¾—
POST   /api/users                       # ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
PATCH  /api/users/:id                   # ãƒ¦ãƒ¼ã‚¶ãƒ¼æ›´æ–°
DELETE /api/users/:id                   # ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤
POST   /api/users/:id/activate          # ãƒ¦ãƒ¼ã‚¶ãƒ¼æœ‰åŠ¹åŒ–
POST   /api/users/:id/deactivate        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ç„¡åŠ¹åŒ–
```

#### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç®¡ç†

```
GET    /api/clients                     # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä¸€è¦§å–å¾—
POST   /api/clients                     # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä½œæˆ
PATCH  /api/clients/:id                 # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ›´æ–°
DELETE /api/clients/:id                 # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå‰Šé™¤
```

#### å”åŠ›è€…ç®¡ç†

```
GET    /api/collaborators               # å”åŠ›è€…ä¸€è¦§å–å¾—
POST   /api/collaborators               # å”åŠ›è€…ä½œæˆ
PATCH  /api/collaborators/:id           # å”åŠ›è€…æ›´æ–°
DELETE /api/collaborators/:id           # å”åŠ›è€…å‰Šé™¤
```

#### çµ„ç¹”æ‹›å¾…

```
GET    /api/org-invitations             # æ‹›å¾…ä¸€è¦§å–å¾—
POST   /api/org-invitations             # çµ„ç¹”ãƒ¡ãƒ³ãƒãƒ¼æ‹›å¾…
GET    /api/org-invitations/stats       # ç¾åœ¨ã®ãƒ¡ãƒ³ãƒãƒ¼æ•°ã¨ä¸Šé™
DELETE /api/org-invitations/:id         # æ‹›å¾…å–ã‚Šæ¶ˆã—
```

---

## ä¸»è¦æ©Ÿèƒ½

### 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†

- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§è¡¨ç¤ºï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã€æ¤œç´¢ï¼‰
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè©³ç´°ï¼ˆã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆã€ã‚¿ã‚¹ã‚¯ä¸€è¦§ï¼‰
- å…¬é–‹ç¯„å›²è¨­å®šï¼ˆprivate/organizationï¼‰
- ã‚½ãƒ•ãƒˆãƒ‡ãƒªãƒ¼ãƒˆï¼ˆå‰Šé™¤æ¸ˆã¿ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯30æ—¥å¾Œã«å®Œå…¨å‰Šé™¤ï¼‰

### 2. ã‚¿ã‚¹ã‚¯ç®¡ç†

- ã‚¿ã‚¹ã‚¯ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤
- ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆè¡¨ç¤º
- ã‚«ãƒ³ãƒãƒ³ãƒœãƒ¼ãƒ‰
- ã‚¿ã‚¹ã‚¯ã®ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
- æ‹…å½“è€…å‰²ã‚Šå½“ã¦
- é€²æ—ç‡ç®¡ç†
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†

### 3. äººå“¡ç®¡ç†

#### ç¤¾å†…ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§è¡¨ç¤º
- ãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ ãƒ»ç·¨é›†ãƒ»å‰Šé™¤
- ãƒ­ãƒ¼ãƒ«å¤‰æ›´
- ãƒ¡ãƒ³ãƒãƒ¼åŒºåˆ†è¨­å®šï¼ˆmember/guestï¼‰
- è·ç¨®ãƒ»éƒ¨ç½²è¨­å®š

#### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç®¡ç†
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä¸€è¦§è¡¨ç¤º
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¿½åŠ ãƒ»ç·¨é›†ãƒ»å‰Šé™¤
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†

#### å”åŠ›è€…ç®¡ç†
- å”åŠ›è€…ä¸€è¦§è¡¨ç¤º
- å”åŠ›è€…è¿½åŠ ãƒ»ç·¨é›†ãƒ»å‰Šé™¤
- å”åŠ›è€…åã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ã¨ã—ã¦å”åŠ›è€…ã‚’è¿½åŠ å¯èƒ½

### 4. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†

- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§è¡¨ç¤º
- ãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ ï¼ˆæ‹›å¾…ï¼‰
  - ç¤¾å†…ãƒ¡ãƒ³ãƒãƒ¼ã‹ã‚‰é¸æŠ
  - å”åŠ›è€…ã‹ã‚‰é¸æŠ
  - ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ç›´æ¥æ‹›å¾…
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ­ãƒ¼ãƒ«è¨­å®š
- æ‹›å¾…æ‰¿èª/è¾é€€
- ãƒ¡ãƒ³ãƒãƒ¼å‰Šé™¤

### 5. æ¨©é™ç®¡ç†

- ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼ˆRBACï¼‰
- ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ­ãƒ¼ãƒ«ï¼ˆã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ï¼‰
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå˜ä½ï¼‰
- çµ„ç¹”ãƒ¬ãƒ™ãƒ«æ¨©é™ã®å„ªå…ˆ
- ãã‚ç´°ã‹ã„æ¨©é™è¨­å®š

### 6. çµ„ç¹”æ‹›å¾…

- çµ„ç¹”ãƒ¡ãƒ³ãƒãƒ¼æ‹›å¾…
- ã‚²ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼æ‹›å¾…
- æ‹›å¾…ä¸€è¦§ç®¡ç†
- æ‹›å¾…å–ã‚Šæ¶ˆã—
- ãƒ¡ãƒ³ãƒãƒ¼æ•°åˆ¶é™ï¼ˆãƒ—ãƒ©ãƒ³åˆ¥ï¼‰

### 7. ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãƒ­ã‚°

- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ“ä½œå±¥æ­´
- ã‚¿ã‚¹ã‚¯æ“ä½œå±¥æ­´
- ãƒ¡ãƒ³ãƒãƒ¼æ“ä½œå±¥æ­´
- å¤‰æ›´å†…å®¹ã®è¨˜éŒ²

---

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ 

### é‡è¦ãƒ•ã‚¡ã‚¤ãƒ«ã®å®Œå…¨ãƒ‘ã‚¹

```
D:\senaa_dev\compass\
â”‚
â”œâ”€â”€ ğŸ“‚ functions/                              # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â””â”€â”€ ğŸ“‚ src/
â”‚       â”œâ”€â”€ ğŸ“„ index.ts                       â­ APIã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“‚ api/                           # å„APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
â”‚       â”‚   â”œâ”€â”€ projects.ts
â”‚       â”‚   â”œâ”€â”€ tasks.ts
â”‚       â”‚   â”œâ”€â”€ project-members-api.ts
â”‚       â”‚   â”œâ”€â”€ collaborators-api.ts          # å”åŠ›è€…API
â”‚       â”‚   â”œâ”€â”€ clients-api.ts                # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆAPI
â”‚       â”‚   â”œâ”€â”€ org-invitations.ts            # çµ„ç¹”æ‹›å¾…API
â”‚       â”‚   â”œâ”€â”€ users-api.ts
â”‚       â”‚   â””â”€â”€ ...
â”‚       â”‚
â”‚       â””â”€â”€ ğŸ“‚ lib/                           # å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒª
â”‚           â”œâ”€â”€ ğŸ“„ auth-types.ts             â­ å‹å®šç¾©ï¼ˆãƒ­ãƒ¼ãƒ«ã€æ¨©é™ï¼‰
â”‚           â”œâ”€â”€ ğŸ“„ roles.ts                  â­ æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹
â”‚           â”œâ”€â”€ ğŸ“„ access-control.ts         â­ ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãƒ­ã‚¸ãƒƒã‚¯
â”‚           â”œâ”€â”€ ğŸ“„ types.ts                  â­ ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«å®šç¾©
â”‚           â”œâ”€â”€ auth.ts                      # èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
â”‚           â”œâ”€â”€ project-members.ts           # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼å‡¦ç†
â”‚           â”œâ”€â”€ users.ts                     # ãƒ¦ãƒ¼ã‚¶ãƒ¼å‡¦ç†
â”‚           â”œâ”€â”€ firestore.ts                 # Firestoreæ“ä½œ
â”‚           â”œâ”€â”€ gmail.ts                     # ãƒ¡ãƒ¼ãƒ«é€ä¿¡
â”‚           â””â”€â”€ validation.ts                # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
â”‚
â”œâ”€â”€ ğŸ“‚ web/                                   # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â””â”€â”€ ğŸ“‚ src/
â”‚       â”œâ”€â”€ ğŸ“„ App.tsx                       â­ ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
â”‚       â”œâ”€â”€ main.tsx
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“‚ pages/                        # ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚       â”‚   â”œâ”€â”€ DashboardPage.tsx
â”‚       â”‚   â”œâ”€â”€ ProjectsPage.tsx
â”‚       â”‚   â”œâ”€â”€ ProjectDetailPage.tsx
â”‚       â”‚   â”œâ”€â”€ AdminPage.tsx
â”‚       â”‚   â””â”€â”€ ...
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“‚ components/                   # UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚       â”‚   â”œâ”€â”€ ProjectMembersDialog.tsx     # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†
â”‚       â”‚   â”œâ”€â”€ UserManagement.tsx           # äººå“¡ç®¡ç†
â”‚       â”‚   â”œâ”€â”€ ProjectEditDialog.tsx
â”‚       â”‚   â”œâ”€â”€ TaskEditDialog.tsx
â”‚       â”‚   â””â”€â”€ ...
â”‚       â”‚
â”‚       â””â”€â”€ ğŸ“‚ lib/                          # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚           â”œâ”€â”€ ğŸ“„ api.ts                    â­ APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚           â”œâ”€â”€ ğŸ“„ auth-types.ts             â­ å‹å®šç¾©ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆå´ï¼‰
â”‚           â”œâ”€â”€ ğŸ“„ types.ts                  â­ ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆå´ï¼‰
â”‚           â”œâ”€â”€ firebaseClient.ts
â”‚           â”œâ”€â”€ auth.tsx
â”‚           â””â”€â”€ utils.ts
â”‚
â”œâ”€â”€ ğŸ“„ firebase.json                          â­ Firebaseè¨­å®š
â”œâ”€â”€ ğŸ“„ firestore.rules                        â­ Firestoreã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«
â”œâ”€â”€ ğŸ“„ firestore.indexes.json                 # Firestoreã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
â”œâ”€â”€ ğŸ“„ .firebaserc                            # Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š
â””â”€â”€ ğŸ“„ TASK_MEMO.md                           # ä½œæ¥­ãƒ¡ãƒ¢
```

---

## é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### ãƒ“ãƒ«ãƒ‰ï¼†ãƒ‡ãƒ—ãƒ­ã‚¤

#### å…¨ä½“ãƒ‡ãƒ—ãƒ­ã‚¤
```bash
firebase deploy
```

#### Functionsã®ã¿ãƒ‡ãƒ—ãƒ­ã‚¤
```bash
cd functions
npm run build
firebase deploy --only functions
```

#### Hostingã®ã¿ãƒ‡ãƒ—ãƒ­ã‚¤
```bash
cd web
npm run build
cd ..
firebase deploy --only hosting
```

#### å¼·åˆ¶ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆå¤‰æ›´ãŒæ¤œå‡ºã•ã‚Œãªã„å ´åˆï¼‰
```bash
cd functions
npm run build
firebase deploy --only functions --force
```

#### ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤
```bash
# functions/package.json ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ›´æ–°
# ä¾‹: "version": "0.1.0" â†’ "0.1.1"
cd functions
npm run build
firebase deploy --only functions --force
```

### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º

#### Functions
```bash
cd functions
npm run serve
```

#### Web
```bash
cd web
npm run dev
```

#### Emulator
```bash
firebase emulators:start
```

### ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

#### ãƒ‡ãƒ—ãƒ­ã‚¤ãŒã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã‚‹å ´åˆ
```bash
# ã‚¯ãƒªãƒ¼ãƒ³ãƒ“ãƒ«ãƒ‰
cd functions
rm -rf lib
npx tsc

# ã¾ãŸã¯
cd web
rm -rf dist node_modules/.vite
npm run build
```

#### ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
```bash
# ãƒ–ãƒ©ã‚¦ã‚¶: Ctrl+Shift+R (ãƒãƒ¼ãƒ‰ãƒªãƒ­ãƒ¼ãƒ‰)
# ã¾ãŸã¯: é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ« â†’ Application â†’ Clear storage
```

---

## ã‚³ãƒ¼ãƒ‰ä¾‹

### APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä½¿ç”¨ä¾‹

```typescript
// web/src/lib/api.ts ã‚ˆã‚Š

// ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§å–å¾—
const { projects } = await listProjects();

// ã‚¿ã‚¹ã‚¯ä½œæˆ
const { id } = await createTask({
  projectId: 'P-0001',
  ã‚¿ã‚¹ã‚¯å: 'è¨­è¨ˆå›³ä½œæˆ',
  äºˆå®šé–‹å§‹æ—¥: '2025-01-01',
  æœŸé™: '2025-01-15',
  assignedTo: 'user123',
  status: 'todo'
});

// ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ 
const response = await fetch(`${BASE_URL}/projects/${projectId}/members`, {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    ...buildAuthHeaders(token),
  },
  body: JSON.stringify({
    email: 'user@example.com',
    role: 'member',
    è·ç¨®: 'è¨­è¨ˆ',
  }),
});

// å”åŠ›è€…ä¸€è¦§å–å¾—
const { collaborators } = await listCollaborators();

// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä½œæˆ
const client = await createClient('æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«');
```

### æ¨©é™ãƒã‚§ãƒƒã‚¯ä¾‹

```typescript
// functions/src/lib/access-control.ts ã‚ˆã‚Š

// ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãƒã‚§ãƒƒã‚¯
const canAccess = await canAccessProject(user, project, orgId);

// ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç·¨é›†æ¨©é™ãƒã‚§ãƒƒã‚¯
const canEdit = await canEditProject(user, project, orgId);

// ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†æ¨©é™ãƒã‚§ãƒƒã‚¯
const canManage = await canManageProjectMembers(user, project, orgId);

// ã‚¿ã‚¹ã‚¯ä½œæˆæ¨©é™ãƒã‚§ãƒƒã‚¯
const canCreateTask = await canCreateTask(user, project, orgId);
```

---

## ç¾åœ¨ã®èª²é¡Œã¨æœªè§£æ±ºäº‹é …

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ã«å”åŠ›è€…ã‚’è¿½åŠ ã™ã‚‹æ©Ÿèƒ½

**çŠ¶æ³**: ã‚³ãƒ¼ãƒ‰å®Ÿè£…æ¸ˆã¿ã€ãƒ‡ãƒ—ãƒ­ã‚¤æ¸ˆã¿ã€ã—ã‹ã—å‹•ä½œã—ã¦ã„ãªã„

**å®Ÿè£…å†…å®¹**:
1. `functions/src/api/collaborators-api.ts` - å”åŠ›è€…APIå®Ÿè£…
2. `web/src/components/ProjectMembersDialog.tsx` - å”åŠ›è€…é¸æŠUIå®Ÿè£…
3. `web/src/components/UserManagement.tsx` - å”åŠ›è€…ç®¡ç†UIå®Ÿè£…

**å•é¡Œ**:
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§å”åŠ›è€…ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œãªã„
- ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã« `[ProjectMembers]` ã®ãƒ­ã‚°ãŒå‡ºãªã„
- ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚‚è¿½åŠ æ¸ˆã¿ã ãŒå‡ºåŠ›ã•ã‚Œãªã„

**ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½**:
```typescript
// ProjectMembersDialog.tsx ã«è¿½åŠ æ¸ˆã¿
console.log('[ProjectMembersDialog] Component mounted');
console.log('[ProjectMembersDialog] Rendering - showInviteForm:', showInviteForm);
console.log('[ProjectMembers] showInviteForm changed:', showInviteForm);
console.log('[ProjectMembers] Loading data...');
console.log('[ProjectMembers] Loading collaborators...');
console.log('[ProjectMembers] Collaborators loaded:', data);
```

**æ¬¡ã®èª¿æŸ»ãƒã‚¤ãƒ³ãƒˆ**:
1. ProjectMembersDialogãŒã©ã“ã‹ã‚‰é–‹ã‹ã‚Œã¦ã„ã‚‹ã‹ç‰¹å®š
2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ­£ã—ã„ç”»é¢ã‚’è¦‹ã¦ã„ã‚‹ã‹ç¢ºèª
3. å”åŠ›è€…ãƒ‡ãƒ¼ã‚¿ãŒFirestoreã«å­˜åœ¨ã™ã‚‹ã‹ç¢ºèª

**å‚è€ƒ**: è©³ç´°ã¯ `TASK_MEMO.md` ã‚’å‚ç…§

---

## è£œè¶³æƒ…å ±

### Firestoreã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«

```
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ãƒã‚§ãƒƒã‚¯
    function isAuthenticated() {
      return request.auth != null;
    }

    // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãƒã‚§ãƒƒã‚¯
    // ... è©³ç´°ã¯firestore.rulesã‚’å‚ç…§
  }
}
```

### ç’°å¢ƒå¤‰æ•°

```bash
# functions/.env
APP_URL=https://compass-31e9e.web.app
CORS_ORIGIN=https://compass-31e9e.web.app,https://compass-31e9e.firebaseapp.com
TASK_REMINDER_ENABLED=true
TASK_REMINDER_CRON=0 9 * * *
TASK_REMINDER_TIMEZONE=Asia/Tokyo
```

### ãƒ—ãƒ©ãƒ³åˆ¶é™

```typescript
export const PLAN_LIMITS = {
  starter: {
    price: 5000,        // Â¥5,000/æœˆ
    members: 5,         // æ­£å¼ãƒ¡ãƒ³ãƒãƒ¼ä¸Šé™
    guests: 10,         // ã‚²ã‚¹ãƒˆä¸Šé™
  },
  business: {
    price: 30000,       // Â¥30,000/æœˆ
    members: 30,
    guests: 100,
  },
  enterprise: {
    price: null,        // ã‚«ã‚¹ã‚¿ãƒ æ–™é‡‘
    members: 999999,    // å®Ÿè³ªç„¡åˆ¶é™
    guests: 999999,
  },
};
```

---

## ã¾ã¨ã‚

Compassã¯ã€å»ºè¨­ãƒ»è¨­è¨ˆæ¥­ç•Œå‘ã‘ã®åŒ…æ‹¬çš„ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚FirebaseæŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã‚’æ´»ç”¨ã—ã€React + TypeScriptã§æ§‹ç¯‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

**ä¸»ãªç‰¹å¾´**:
- ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®ç´°ã‹ã„æ¨©é™ç®¡ç†
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ»ã‚¿ã‚¹ã‚¯ãƒ»äººå“¡ã®ä¸€å…ƒç®¡ç†
- å”åŠ›ä¼šç¤¾ã‚„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’å«ã‚€æŸ”è»Ÿãªãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†
- ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆã«ã‚ˆã‚‹è¦–è¦šçš„ãªã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãªé€²æ—å…±æœ‰

**æŠ€è¡“çš„ç‰¹å¾´**:
- TypeScriptã«ã‚ˆã‚‹å‹å®‰å…¨ãªé–‹ç™º
- Firebase Functionsã«ã‚ˆã‚‹ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- Cloud Firestoreã«ã‚ˆã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- Firebase Authenticationã«ã‚ˆã‚‹å®‰å…¨ãªèªè¨¼

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç†è§£ã‚’æ·±ã‚ã‚‹ãŸã‚ã®åŒ…æ‹¬çš„ãªãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã¨ã—ã¦ä½œæˆã•ã‚Œã¾ã—ãŸã€‚
